{"version":3,"file":"fireEvent.js","names":["_act","_interopRequireDefault","require","_componentTree","_hostComponentNames","obj","__esModule","default","isHostTextInput","element","type","getHostComponentNames","textInput","isTouchResponder","isHostElement","Boolean","props","onStartShouldSetResponder","isPointerEventEnabled","isParent","pointerEvents","parent","getHostParent","eventsAffectedByPointerEventsProp","Set","textInputEventsIgnoringEditableProp","isEventEnabled","eventName","nearestTouchResponder","editable","has","touchStart","touchMove","onMoveShouldSetResponder","undefined","findEventHandler","touchResponder","handler","getEventHandler","eventHandlerName","getEventHandlerName","charAt","toUpperCase","slice","fireEvent","data","returnValue","act","press","changeText","scroll","_default","exports"],"sources":["../src/fireEvent.ts"],"sourcesContent":["import { ReactTestInstance } from 'react-test-renderer';\nimport act from './act';\nimport { getHostParent, isHostElement } from './helpers/component-tree';\nimport { getHostComponentNames } from './helpers/host-component-names';\n\ntype EventHandler = (...args: unknown[]) => unknown;\n\nconst isHostTextInput = (element?: ReactTestInstance) => {\n  return element?.type === getHostComponentNames().textInput;\n};\n\nfunction isTouchResponder(element: ReactTestInstance) {\n  if (!isHostElement(element)) {\n    return false;\n  }\n\n  return (\n    Boolean(element.props.onStartShouldSetResponder) || isHostTextInput(element)\n  );\n}\n\nfunction isPointerEventEnabled(\n  element: ReactTestInstance,\n  isParent?: boolean\n): boolean {\n  const pointerEvents = element.props.pointerEvents;\n  if (pointerEvents === 'none') {\n    return false;\n  }\n\n  if (isParent ? pointerEvents === 'box-only' : pointerEvents === 'box-none') {\n    return false;\n  }\n\n  const parent = getHostParent(element);\n  if (!parent) {\n    return true;\n  }\n\n  return isPointerEventEnabled(parent, true);\n}\n\n/**\n * List of events affected by `pointerEvents` prop.\n *\n * Note: `fireEvent` is accepting both `press` and `onPress` for event names,\n * so we need cover both forms.\n */\nconst eventsAffectedByPointerEventsProp = new Set(['press', 'onPress']);\n\n/**\n * List of `TextInput` events not affected by `editable` prop.\n *\n * Note: `fireEvent` is accepting both `press` and `onPress` for event names,\n * so we need cover both forms.\n */\nconst textInputEventsIgnoringEditableProp = new Set([\n  'contentSizeChange',\n  'onContentSizeChange',\n  'layout',\n  'onLayout',\n  'scroll',\n  'onScroll',\n]);\n\nfunction isEventEnabled(\n  element: ReactTestInstance,\n  eventName: string,\n  nearestTouchResponder?: ReactTestInstance\n) {\n  if (isHostTextInput(nearestTouchResponder)) {\n    return (\n      nearestTouchResponder?.props.editable !== false ||\n      textInputEventsIgnoringEditableProp.has(eventName)\n    );\n  }\n\n  if (\n    eventsAffectedByPointerEventsProp.has(eventName) &&\n    !isPointerEventEnabled(element)\n  ) {\n    return false;\n  }\n\n  const touchStart = nearestTouchResponder?.props.onStartShouldSetResponder?.();\n  const touchMove = nearestTouchResponder?.props.onMoveShouldSetResponder?.();\n  if (touchStart || touchMove) {\n    return true;\n  }\n\n  return touchStart === undefined && touchMove === undefined;\n}\n\nfunction findEventHandler(\n  element: ReactTestInstance,\n  eventName: string,\n  nearestTouchResponder?: ReactTestInstance\n): EventHandler | null {\n  const touchResponder = isTouchResponder(element)\n    ? element\n    : nearestTouchResponder;\n\n  const handler = getEventHandler(element, eventName);\n  if (handler && isEventEnabled(element, eventName, touchResponder))\n    return handler;\n\n  if (element.parent === null || element.parent.parent === null) {\n    return null;\n  }\n\n  return findEventHandler(element.parent, eventName, touchResponder);\n}\n\nfunction getEventHandler(element: ReactTestInstance, eventName: string) {\n  const eventHandlerName = getEventHandlerName(eventName);\n  if (typeof element.props[eventHandlerName] === 'function') {\n    return element.props[eventHandlerName];\n  }\n\n  if (typeof element.props[eventName] === 'function') {\n    return element.props[eventName];\n  }\n\n  return undefined;\n}\n\nfunction getEventHandlerName(eventName: string) {\n  return `on${eventName.charAt(0).toUpperCase()}${eventName.slice(1)}`;\n}\n\nfunction fireEvent(\n  element: ReactTestInstance,\n  eventName: string,\n  ...data: unknown[]\n) {\n  const handler = findEventHandler(element, eventName);\n  if (!handler) {\n    return;\n  }\n\n  let returnValue;\n  act(() => {\n    returnValue = handler(...data);\n  });\n\n  return returnValue;\n}\n\nfireEvent.press = (element: ReactTestInstance, ...data: unknown[]) =>\n  fireEvent(element, 'press', ...data);\n\nfireEvent.changeText = (element: ReactTestInstance, ...data: unknown[]) =>\n  fireEvent(element, 'changeText', ...data);\n\nfireEvent.scroll = (element: ReactTestInstance, ...data: unknown[]) =>\n  fireEvent(element, 'scroll', ...data);\n\nexport default fireEvent;\n"],"mappings":"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"}